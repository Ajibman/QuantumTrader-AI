<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OmniScanner — QuantumTrader AI™</title>

  <link rel="stylesheet" href="css/core.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">

  <style>
    /* OmniScanner specific styles (place into components.css if you prefer) */
    :root {
      --bg: #060708;
      --panel: #0f1112;
      --muted: #9fb0c6;
      --accent: #35b3ff;
      --glass: rgba(255,255,255,0.03);
      --card-radius: 12px;
    }

    body.dark-page { background: var(--bg); color: #eaf3ff; font-family: Inter, sans-serif; }

    .omni-wrap {
      max-width: 1200px;
      margin: 22px auto;
      padding: 16px;
      width: calc(100% - 32px);
    }

    .omni-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }
    .omni-title {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .omni-title h1 { font-size: 1.25rem; margin: 0; }
    .omni-title p { margin: 0; opacity: 0.7; font-size: .9rem; }

    /* scanner area */
    .scanner {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 18px;
      align-items: start;
    }

    /* left: rotating ring / carousel */
    .scanner-ring {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.04);
      border-radius: var(--card-radius);
      padding: 18px;
      min-height: 420px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .ring-viewport {
      position: relative;
      height: 320px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow: visible;
      perspective: 1200px;
    }

    .ring {
      position: relative;
      width: 320px;
      height: 320px;
      transform-style: preserve-3d;
      transition: transform 600ms cubic-bezier(.2,.9,.3,1);
    }

    .ring-item {
      position: absolute;
      left: 50%;
      top: 50%;
      transform-origin: 0 0;
      transform-style: preserve-3d;
      width: 140px;
      height: 88px;
      margin-left: -70px;
      margin-top: -44px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.04);
      border-radius: 8px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding: 8px 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
      backface-visibility: hidden;
      cursor: grab;
    }
    .ring-item h3 { margin:0; font-size: 0.95rem; }
    .ring-item p { margin: 6px 0 0; font-size: .78rem; opacity: 0.75; }

    .ring-controls { display:flex; gap:8px; justify-content:center; margin-top: 8px; }
    .btn { background: transparent; border: 1px solid rgba(255,255,255,0.06); padding:8px 12px; border-radius:8px; color:inherit; cursor:pointer; }
    .btn.primary { border-color: var(--accent); box-shadow: 0 6px 18px rgba(53,179,255,0.06); }

    /* right: preview panel */
    .preview {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--card-radius);
      padding: 16px;
      min-height: 420px;
      border: 1px solid rgba(255,255,255,0.04);
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .preview .title-row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .preview h2 { margin:0; font-size:1.05rem; }
    .preview .meta { font-size:.82rem; opacity:.72; }

    .preview .metric-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; margin-top:8px; }
    .metric { background: var(--glass); padding:10px; border-radius:8px; font-size:.92rem; text-align:center; }
    .chart-placeholder { height: 160px; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; border: 1px dashed rgba(255,255,255,0.04); display:flex; align-items:center; justify-content:center; color:var(--muted); }

    .preview .actions { margin-top:auto; display:flex; gap:10px; }

    /* small screens */
    @media (max-width: 980px) {
      .scanner { grid-template-columns: 1fr; }
      .ring { width: 260px; height: 260px; }
      .ring-item { width: 120px; height: 76px; margin-left:-60px; margin-top:-38px; }
      .preview { order: 2; }
    }

    /* hover focus */
    .ring-item:focus, .ring-item:hover { transform: translateZ(40px) scale(1.03); outline:none; }
  </style>
</head>

<body class="dark-page">
  <div class="omni-wrap">
    <div class="omni-header">
      <div class="omni-title">
        <h1>OmniScanner</h1>
        <p>360° rotating market viewport — quick-scan markets & deep-scan into modules</p>
      </div>

      <div class="omni-controls">
        <button id="scan-360" class="btn">360° Scan</button>
        <button id="scan-180" class="btn">180° Sweep</button>
        <button id="autoplay" class="btn">Auto Play</button>
      </div>
    </div>

    <div class="scanner">
      <!-- LEFT: rotating ring -->
      <div class="scanner-ring" role="region" aria-label="Markets ring">
        <div class="ring-viewport">
          <div id="ring" class="ring" tabindex="0" aria-live="polite" aria-label="Rotating markets wheel">
            <!-- JS will populate the ring items -->
          </div>
        </div>

        <div class="ring-controls" aria-hidden="false">
          <button id="prev" class="btn">◀ Prev</button>
          <button id="focus" class="btn primary">Deep Scan</button>
          <button id="next" class="btn">Next ▶</button>
        </div>
      </div>

      <!-- RIGHT: preview panel -->
      <aside class="preview" aria-label="Selected market preview">
        <div class="title-row">
          <div>
            <h2 id="preview-title">—</h2>
            <div class="meta" id="preview-sub">Select a market from the scanner</div>
          </div>
          <div class="meta" id="preview-status">Idle</div>
        </div>

        <div class="metric-grid" id="preview-metrics">
          <div class="metric">Vol: —</div>
          <div class="metric">Liquidity: —</div>
          <div class="metric">Mom: —</div>
          <div class="metric">Risk: —</div>
        </div>

        <div class="chart-placeholder" id="preview-chart">Chart Preview</div>

        <div class="actions">
          <button id="open-market" class="btn primary">Open Market Module</button>
          <button id="quick-scan" class="btn">Quick Scan</button>
          <button id="watchlist" class="btn">Add to Watchlist</button>
        </div>
      </aside>
    </div>
  </div>

  <script>
  /* OmniScanner UI JS
     - populates ring from a static list for now (B will replace with real scanning data)
     - supports prev/next, autoplay, 360/180 animated rotations
     - deep-scan opens market module in new window (general-markets/*)
     - supports keyboard and touch swipe
  */

  (function(){
    // Market list (order is the rotation order)
    const markets = [
      { id: 'forex', title: 'Forex', subtitle: 'Global currency markets', path: 'general-markets/forex.html' },
      { id: 'crypto', title: 'Cryptocurrency', subtitle: 'Digital asset markets', path: 'general-markets/cryptocurrency.html' },
      { id: 'metals', title: 'Metals', subtitle: 'Gold, Silver, Platinum', path: 'general-markets/metals.html' },
      { id: 'solid-minerals', title: 'Solid Minerals', subtitle: 'Mining outputs & logistics', path: 'general-markets/solid-minerals.html' },
      { id: 'bonds', title: 'Bonds', subtitle: 'Government & Corporate yields', path: 'general-markets/bonds.html' },
      { id: 'foods', title: 'Food & Agriculture', subtitle: 'Grains & softs', path: 'general-markets/foods.html' },
      { id: 'logistics', title: 'Global Logistics', subtitle: 'Freight & port indices', path: 'general-markets/logistics.html' },
      { id: 'sp500', title: 'S&P 500', subtitle: 'US Equities Index', path: 'general-markets/sp500.html' },
      { id: 'energy', title: 'Energy', subtitle: 'Oil, Gas, Renewables', path: 'general-markets/energy.html' }
    ];

    const ringEl = document.getElementById('ring');
    const previewTitle = document.getElementById('preview-title');
    const previewSub = document.getElementById('preview-sub');
    const previewStatus = document.getElementById('preview-status');
    const previewMetrics = document.getElementById('preview-metrics');
    const previewChart = document.getElementById('preview-chart');
    const openMarketBtn = document.getElementById('open-market');
    const quickScanBtn = document.getElementById('quick-scan');
    const watchlistBtn = document.getElementById('watchlist');

    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const focusBtn = document.getElementById('focus');
    const scan360Btn = document.getElementById('scan-360');
    const scan180Btn = document.getElementById('scan-180');
    const autoplayBtn = document.getElementById('autoplay');

    let selectedIndex = 0;
    let angle = 0; // current rotation angle
    let autoplay = false;
    let autoplayInterval = null;

    // create items on the ring
    function createRingItems() {
      ringEl.innerHTML = '';
      const count = markets.length;
      const radius = 120; // px radius for layout
      for (let i = 0; i < count; i++) {
        const item = document.createElement('button');
        item.className = 'ring-item';
        item.setAttribute('data-index', i);
        item.setAttribute('aria-label', markets[i].title + ' — ' + markets[i].subtitle);
        item.tabIndex = 0;
        item.innerHTML = `<h3>${markets[i].title}</h3><p>${markets[i].subtitle}</p>`;
        // compute position around circle
        const theta = (360 / count) * i;
        const rad = theta * Math.PI / 180;
        // place in 3D circle: translate + rotate
        item.style.transform = `rotate(${theta}deg) translate(${radius}px) rotate(${theta * -1}deg)`;
        // click selects
        item.addEventListener('click', () => selectIndex(i));
        item.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectIndex(i); }
        });
        ringEl.appendChild(item);
      }
    }

    function updateRotation() {
      const count = markets.length;
      // angle so that selected item faces front/top (0deg)
      const step = 360 / count;
      angle = -selectedIndex * step;
      ringEl.style.transform = `rotate(${angle}deg)`;
      // highlight the front item
      Array.from(ringEl.children).forEach((c, idx) => {
        c.style.opacity = (idx === selectedIndex ? '1' : '0.65');
        c.style.transform = c.style.transform + (idx === selectedIndex ? ' translateZ(30px)' : '');
      });
      // update preview panel
      refreshPreview(selectedIndex);
    }

    function selectIndex(i) {
      selectedIndex = (i + markets.length) % markets.length;
      updateRotation();
    }

    function next() { selectIndex(selectedIndex + 1); }
    function prev() { selectIndex(selectedIndex - 1); }

    // scan animations
    function animateSweep(degPerStep=20, totalDeg=360, duration=1200) {
      const start = performance.now();
      const initial = angle;
      const target = angle - totalDeg;
      function step(now){
        const t = Math.min(1, (now - start) / duration);
        const eased = (1 - Math.pow(1 - t, 3)); // ease out cubic
        const current = initial + (target - initial) * eased;
        ringEl.style.transform = `rotate(${current}deg)`;
        if (t < 1) requestAnimationFrame(step);
        else { angle = target % 360; updateRotation(); }
      }
      requestAnimationFrame(step);
    }

    // preview panel refresh — placeholder simulated data
    function refreshPreview(i) {
      const m = markets[i];
      previewTitle.textContent = m.title;
      previewSub.textContent = m.subtitle;
      previewStatus.textContent = 'Live preview';
      // fake metrics (placeholder) — these will be populated by B
      const metrics = [
        { label: 'Vol', value: `${(Math.random()*5+0.5).toFixed(2)}%` },
        { label: 'Liquidity', value: `${(Math.random()*100+20).toFixed(0)}k` },
        { label: 'Momentum', value: `${(Math.random()*2-1).toFixed(2)}` },
        { label: 'Risk', value: `${(Math.random()*10+1).toFixed(0)}` }
      ];
      const metricEls = previewMetrics.querySelectorAll('.metric');
      metricEls.forEach((el, idx) => el.textContent = `${metrics[idx].label}: ${metrics[idx].value}`);
      previewChart.textContent = `${m.title} — mini chart (placeholder)`;
      // set open-link
      openMarketBtn.dataset.path = m.path;
      quickScanBtn.dataset.path = m.path;
    }

    // open market
    openMarketBtn.addEventListener('click', () => {
      const p = openMarketBtn.dataset.path;
      if (p) window.open(p, '_blank', 'noopener,noreferrer');
    });

    quickScanBtn.addEventListener('click', () => {
      previewStatus.textContent = 'Quick scan completed';
      // small animation to indicate a scan (placeholder)
      previewChart.style.opacity = '0.6';
      setTimeout(()=> previewChart.style.opacity = '1', 400);
    });

    watchlistBtn.addEventListener('click', () => {
      previewStatus.textContent = 'Added to watchlist';
      watchlistBtn.textContent = 'Added ✓';
      setTimeout(()=> watchlistBtn.textContent = 'Add to Watchlist', 1400);
    });

    // prev/next handlers
    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);

    focusBtn.addEventListener('click', () => {
      // deep-scan: open the module
      const p = openMarketBtn.dataset.path;
      if (p) window.open(p, '_blank', 'noopener,noreferrer');
    });

    scan360Btn.addEventListener('click', () => animateSweep(30, 360, 1400));
    scan180Btn.addEventListener('click', () => animateSweep(20, 180, 900));

    // autoplay toggling
    autoplayBtn.addEventListener('click', () => {
      autoplay = !autoplay;
      autoplayBtn.textContent = autoplay ? 'Stop' : 'Auto Play';
      if (autoplay) {
        autoplayInterval = setInterval(next, 1400);
      } else {
        clearInterval(autoplayInterval);
      }
    });

    // keyboard navigation
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prev();
      if (e.key === 'ArrowRight') next();
      if (e.key === 'Enter') {
        // deep scan on enter
        const p = openMarketBtn.dataset.path;
        if (p) window.open(p, '_blank', 'noopener,noreferrer');
      }
    });

    // basic touch swipe on ring-viewport
    (function addTouch(){
      const viewport = document.querySelector('.ring-viewport');
      let startX = 0, startY = 0, startTime = 0;
      viewport.addEventListener('touchstart', (ev) => {
        const t = ev.touches[0];
        startX = t.clientX; startY = t.clientY; startTime = Date.now();
      }, {passive:true});
      viewport.addEventListener('touchend', (ev) => {
        const t = ev.changedTouches[0];
        const dx = t.clientX - startX;
        const dt = Date.now() - startTime;
        if (Math.abs(dx) > 30 && dt < 400) {
          if (dx > 0) prev(); else next();
        }
      }, {passive:true});
    })();

    // initialize
    createRingItems();
    // create metric placeholders inside preview
    previewMetrics.innerHTML = '<div class="metric">Vol: —</div><div class="metric">Liquidity: —</div><div class="metric">Mom: —</div><div class="metric">Risk: —</div>';
    selectIndex(0);

  })();
  </script>
</body>
</html>
