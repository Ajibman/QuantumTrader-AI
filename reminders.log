#!/bin/bash

REMINDERS_FILE="reminders.log"
BACKUP_DIR="backups"
TEST_LOG="TEST_LOG.md"
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")
COMMIT_HASH=$(git rev-parse --short HEAD 2>/dev/null || echo "nohash")
BACKUP_FILE="$BACKUP_DIR/TEST_LOG_$(date +%Y-%m-%d_%H-%M-%S)_$COMMIT_HASH.md"

mkdir -p $BACKUP_DIR

# Ensure TEST_LOG.md has headings if it's empty
if [ ! -s "$TEST_LOG" ]; then
  echo "# TEST LOG" > $TEST_LOG
  echo -e "\n## Commits" >> $TEST_LOG
  echo -e "\n## Cleanup" >> $TEST_LOG
fi

# Log new commit entry
echo "[$TIMESTAMP] Commit saved (hash: $COMMIT_HASH)." >> $REMINDERS_FILE
sed -i "/^## Cleanup/i - [$TIMESTAMP] Commit saved (hash: $COMMIT_HASH)." $TEST_LOG

# Backup TEST_LOG.md with timestamp+hash
cp $TEST_LOG $BACKUP_FILE

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
TOTAL_BACKUPS=$(ls -1t $BACKUP_DIR/TEST_LOG_*.md 2>/dev/null | wc -l)

if [ "$TOTAL_BACKUPS" -gt 50 ]; then
  ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --
  echo "[$TIMESTAMP] ♻️ cleaned backups, kept last 50." >> $REMINDERS_FILE
  sed -i "/^## Cleanup/a - [$TIMESTAMP] ♻️ cleaned backups, kept last 50." $TEST_LOG
fi

# Silent auto-commit
git add .
git commit -m "Auto-commit at $TIMESTAMP (hash: $COMMIT_HASH)" >/dev/null 2>&1
git push origin main >/dev/null 2>&1

#!/bin/bash

REMINDERS_FILE="reminders.log"
BACKUP_DIR="backups"
TEST_LOG="TEST_LOG.md"
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

mkdir -p $BACKUP_DIR

# Log new commit entry
echo "[$TIMESTAMP] Commit saved." >> $REMINDERS_FILE
echo "- [$TIMESTAMP] Commit saved." >> $TEST_LOG

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
TOTAL_BACKUPS=$(ls -1t $BACKUP_DIR/TEST_LOG_*.md 2>/dev/null | wc -l)

if [ "$TOTAL_BACKUPS" -gt 50 ]; then
  ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --
  echo "[$TIMESTAMP] ♻️ cleaned backups, kept last 50." >> $REMINDERS_FILE
  echo "- [$TIMESTAMP] ♻️ cleaned backups, kept last 50." >> $TEST_LOG
fi

# Silent auto-commit
git add .
git commit -m "Auto-commit at $TIMESTAMP" >/dev/null 2>&1
git push origin main >/dev/null 2>&1

#!/bin/bash

REMINDERS_FILE="reminders.log"
BACKUP_DIR="backups"
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

mkdir -p $BACKUP_DIR

# Log new commit entry
echo "[$TIMESTAMP] Commit saved." >> $REMINDERS_FILE

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
TOTAL_BACKUPS=$(ls -1t $BACKUP_DIR/TEST_LOG_*.md 2>/dev/null | wc -l)

if [ "$TOTAL_BACKUPS" -gt 50 ]; then
  ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --
  echo "[$TIMESTAMP] ♻️ cleaned backups, kept last 50." >> $REMINDERS_FILE
fi

# Silent auto-commit
git add .
git commit -m "Auto-commit at $TIMESTAMP" >/dev/null 2>&1
git push origin main >/dev/null 2>&1

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --

git add reminders.log

git commit -m "chore: add reminders.log with initial template"

git commit -m "docs(reminders): log [YYYY-MM-DD] task about <short task description>"

git push origin main

git add reminders.log
git commit -m "docs(reminders): add reminder to review .env variables"
git push origin main
