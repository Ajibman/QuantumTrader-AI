#!/bin/bash

REMINDERS_FILE="reminders.log"
BACKUP_DIR="backups"
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

mkdir -p $BACKUP_DIR

# Log new commit entry
echo "[$TIMESTAMP] Commit saved." >> $REMINDERS_FILE

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
TOTAL_BACKUPS=$(ls -1t $BACKUP_DIR/TEST_LOG_*.md 2>/dev/null | wc -l)

if [ "$TOTAL_BACKUPS" -gt 50 ]; then
  ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --
  echo "[$TIMESTAMP] ♻️ cleaned backups, kept last 50." >> $REMINDERS_FILE
fi

# Silent auto-commit
git add .
git commit -m "Auto-commit at $TIMESTAMP" >/dev/null 2>&1
git push origin main >/dev/null 2>&1

# Trim reminders.log to last 50 entries
tail -n 50 $REMINDERS_FILE > $REMINDERS_FILE.tmp && mv $REMINDERS_FILE.tmp $REMINDERS_FILE

# Keep only last 50 TEST_LOG.md backups
ls -1t $BACKUP_DIR/TEST_LOG_*.md | tail -n +51 | xargs -r rm --

git add reminders.log

git commit -m "chore: add reminders.log with initial template"

git commit -m "docs(reminders): log [YYYY-MM-DD] task about <short task description>"

git push origin main

git add reminders.log
git commit -m "docs(reminders): add reminder to review .env variables"
git push origin main
