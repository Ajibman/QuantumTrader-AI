name: üß≠ QT AI Mode Switch & Flight Control

on:
  schedule:
    - cron: "0 0 * * *"   # Runs once daily at midnight UTC
  workflow_dispatch:        # Allow manual run

jobs:
  mode_switch:
    runs-on: ubuntu-latest

    steps:
      - name: üß© Checkout repo
        uses: actions/checkout@v4

      - name: üîç Determine Current Mode
        id: modecheck
        run: |
          TODAY=$(date +'%Y-%m-%d')
          TESTDATE="2025-11-02"
          FINALDATE="2025-11-09"
          echo "Today: $TODAY"
          if [[ "$TODAY" < "$TESTDATE" ]]; then
            MODE="PREPARATION"
          elif [[ "$TODAY" == "$TESTDATE" ]]; then
            MODE="TEST_FLIGHT"
          elif [[ "$TODAY" > "$TESTDATE" && "$TODAY" < "$FINALDATE" ]]; then
            MODE="TEST_FLIGHT_PHASE"
          elif [[ "$TODAY" == "$FINALDATE" || "$TODAY" > "$FINALDATE" ]]; then
            MODE="FULL_ROLLOUT"
          fi
          echo "mode=$MODE" >> $GITHUB_OUTPUT

      - name: üß† Log Current Mode
        run: |
          mkdir -p logs
          echo "$(date): Mode set to ${{ steps.modecheck.outputs.mode }}" >> logs/mode-switch.log
          cat logs/mode-switch.log

      - name: üì® Email Mode Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "üß≠ QT AI Mode Update ‚Äî ${{ steps.modecheck.outputs.mode }}"
          to: ajibulurobotman@gmail.com
          from: "QuantumTrader AI Control <${{ secrets.EMAIL_USER }}>"
          secure: true
          body: |
            Hello Olagoke Ajibulu,

            QuantumTrader AI has automatically updated its operational mode:

            üß† **Current Mode:** ${{ steps.modecheck.outputs.mode }}

            System time (UTC): $(date)

            ‚Äî QT AI Flight Control
