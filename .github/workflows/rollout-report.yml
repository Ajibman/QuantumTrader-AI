name: 🚀 QT AI Rollout Report Automation

on:
  schedule:
    - cron: "0 */6 * * *"   # Every 6 hours (adjustable)
  workflow_dispatch:        # Allows manual trigger anytime

jobs:
  send_rollout_report:
    runs-on: ubuntu-latest

    steps:
      - name: 📦 Checkout repository
        uses: actions/checkout@v4

      - name: 🧠 Generate Rollout Summary
        id: summary
        run: |
          echo "📊 QuantumTrader-AI Rollout Status Report" > rollout_report.txt
          echo "Date: $(date)" >> rollout_report.txt
          echo "" >> rollout_report.txt
          echo "🧩 Repository: QuantumTrader-AI" >> rollout_report.txt
          echo "🌐 Environment: Production Sync (QonexAI Linked)" >> rollout_report.txt
          echo "" >> rollout_report.txt
          echo "🧠 Status Highlights:" >> rollout_report.txt
          echo "- ✅ Core modules verified" >> rollout_report.txt
          echo "- 🔄 Sync system operational" >> rollout_report.txt
          echo "- 🛰️ CCLM²™ Supervisor Layer active" >> rollout_report.txt
          echo "- 💾 Backup status: OK" >> rollout_report.txt
          echo "- ⚙️ Next rollout testflight: November 02, 2025" >> rollout_report.txt
          echo "" >> rollout_report.txt
          echo "Log excerpt (last 20 lines):" >> rollout_report.txt
          tail -n 20 logs/system.log >> rollout_report.txt || echo "No logs available."

      - name: 📨 Send Rollout Report via Email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "📡 QT AI Rollout Report — $(date +'%Y-%m-%d %H:%M')"
          to: ajibulurobotman@gmail.com
          from: "QuantumTrader AI <${{ secrets.EMAIL_USER }}>"
          secure: true
          body: |
            Hello Olagoke Ajibulu,

            Your automated QuantumTrader-AI rollout report is ready.

            Please find below a summary of system readiness and performance.

            Kind regards,  
            — QT AI Rollout Reporter
          attachments: rollout_report.txt
