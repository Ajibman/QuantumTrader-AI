<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuantumTrader AI - TradingFloor</title>
<link rel="stylesheet" href="qtai.css">
<style>
  /* ----- TradingFloor Container ----- */
  #tradingfloor {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 20px;
  }

  /* Apex TradingFloor */
  #tradingfloor-apex {
    width: 90%;
    height: 300px;
    background: url('tradingfloor2_main.png') no-repeat center center;
    background-size: contain;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 30px;
    position: relative;
  }

  /* Modules 01-15 rotational plane */
  #modules-plane {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 40px;
  }

  .module {
    width: 100px;
    height: 100px;
    background: #222;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #0f0;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    transition: transform 0.3s ease, background 0.3s ease;
  }

  .module:hover {
    transform: scale(1.1) rotate(5deg);
    background: #333;
  }

  /* TraderLab & Copilot panels */
  #panels {
    width: 95%;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin-bottom: 40px;
    gap: 20px;
  }

  .panel {
    width: 48%;
    background: #111;
    color: #fff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }

  .panel h3 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: #0ff;
  }

  /* Top globe and bottom Ori Olokun image */
  #top-globe {
    width: 300px;
    margin-bottom: 20px;
  }

  #bottom-ori-olokun {
    width: 200px;
    margin-top: 40px;
  }
</style>
</head>
<body>

<!-- QuantumTrader AI Globe Top -->
<img id="top-globe" src="qtai_globe.png" alt="QuantumTrader AI Globe">

<!-- TradingFloor Container -->
<div id="tradingfloor">

  <!-- Apex TradingFloor -->
  <div id="tradingfloor-apex">
    TradingFloor Apex Node
  </div>

  <!-- Modules Plane -->
  <div id="modules-plane">
    <div class="module">M01</div>
    <div class="module">M02</div>
    <div class="module">M03</div>
    <div class="module">M04</div>
    <div class="module">M05</div>
    <div class="module">M06</div>
    <div class="module">M07</div>
    <div class="module">M08</div>
    <div class="module">M09</div>
    <div class="module">M10</div>
    <div class="module">M11</div>
    <div class="module">M12</div>
    <div class="module">M13</div>
    <div class="module">M14</div>
    <div class="module">M15</div>
  </div>

  <!-- TraderLab & Copilot Panels -->
  <div id="panels">
    <div class="panel" id="traderlab-panel">
      <h3>TraderLab</h3>
      <p>Simulated trade signals will appear here tick by tick.</p>
    </div>
    <div class="panel" id="copilot-panel">
      <h3>Copilot Hints</h3>
      <p>Trading insights, guidance, and system alerts will appear here.</p>
    </div>
  </div>

</div>

<!-- Ori Olokun Image Bottom -->
<img id="bottom-ori-olokun" src="qtai_ori_olokun.png" alt="Ori Olokun">

<!-- ----- JS for AutoTrader Simulation Signals ----- -->
<script>
  const modules = document.querySelectorAll('.module');

  // Map signals to colors
  const signalColors = {
    BUY: '#0f0',   // green
    SELL: '#f00',  // red
    HOLD: '#ff0'   // yellow
  };

  // Update modules with signal data
  function updateModules(signals) {
    // Reset all modules
    modules.forEach(mod => mod.style.background = '#222');

    // Apply signals
    signals.forEach(signal => {
      if (modules[signal.module]) {
        modules[signal.module].style.background = signalColors[signal.signal] || '#222';
      }
    });
  }

  // ----- Simulation Tick Generator -----
  function simulateAutoTraderSignals() {
    const tickSignals = [];
    const count = Math.floor(Math.random() * 3) + 1; // 1-3 signals
    const usedIndices = [];

    for (let i = 0; i < count; i++) {
      let idx;
      do {
        idx = Math.floor(Math.random() * modules.length);
      } while (usedIndices.includes(idx));
      usedIndices.push(idx);

      const types = ['BUY', 'SELL', 'HOLD'];
      const signalType = types[Math.floor(Math.random() * types.length)];

      tickSignals.push({ module: idx, signal: signalType });
    }

    updateModules(tickSignals);
  }

  // Run every 500ms for tick simulation
  setInterval(simulateAutoTraderSignals, 500);

  // ----- Real AutoTrader Integration Placeholder -----
  // Replace simulateAutoTraderSignals() with:
  // AutoTrader.onTick(signals => updateModules(signals));
</script>

<script type="module">
  import { connect, subscribe } from 'https://cdn.jsdelivr.net/npm/@liftbridge/liftbridge-client/dist/liftbridge-client.min.js';

  const modules = document.querySelectorAll('.module');

  // Map signals to colors
  const signalColors = {
    BUY: '#0f0',   // green
    SELL: '#f00',  // red
    HOLD: '#ff0'   // yellow
  };

  // Update modules based on signals
  function updateModules(signals) {
    modules.forEach(mod => mod.style.background = '#222'); // Reset
    signals.forEach(signal => {
      if (modules[signal.module] !== undefined) {
        modules[signal.module].style.background = signalColors[signal.signal] || '#222';
      }
    });
  }

  // ----- Simulation Fallback -----
  function simulateSignals() {
    const tickSignals = [];
    const count = Math.floor(Math.random() * 3) + 1;
    const used = [];
    for (let i = 0; i < count; i++) {
      let idx;
      do { idx = Math.floor(Math.random() * modules.length); } while (used.includes(idx));
      used.push(idx);
      const types = ['BUY', 'SELL', 'HOLD'];
      tickSignals.push({ module: idx, signal: types[Math.floor(Math.random() * types.length)] });
    }
    updateModules(tickSignals);
  }

  // ----- Liftbridge Subscription -----
  async function startLiftbridgeFeed() {
    try {
      // Connect to Liftbridge server
      const client = await connect('ws://localhost:9292'); // Replace with your Liftbridge URL

      // Subscribe to AutoTrader topic
      const subscription = await subscribe(client, {
        subject: 'autotrader.signals',
        startPosition: 'new_only', // only receive new messages
        onMessage: (msg) => {
          try {
            const signals = JSON.parse(msg.value.toString());
            // Expecting signals like [{ module: 0, signal: 'BUY' }, ...]
            updateModules(signals);
          } catch (err) {
            console.error('Invalid Liftbridge message', err);
          }
        }
      });

      console.log('Subscribed to Liftbridge AutoTrader signals.');
    } catch (e) {
      console.warn('Liftbridge unavailable. Running simulation.');
      setInterval(simulateSignals, 500);
    }
  }

  startLiftbridgeFeed();
</script>
  
</body>
</html>
